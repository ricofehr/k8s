---

- name: Ensure helm-values folder is present
  file:
    path: helm-values
    state: directory
    mode: 0755

- name: Values parameters file
  template:
    src: templates/values.yaml.j2
    dest: helm-values/gitea.yml

- name: Add gogs chart repo
  community.kubernetes.helm_repository:
    name: novum-rgi-helm
    repo_url: "https://novumrgi.github.io/helm/"

- name: Deploy gitea
  community.kubernetes.helm:
    name: gitea
    chart_ref: novum-rgi-helm/gitea
    release_namespace: default
    values_files:
      - helm-values/gitea.yml

